zstyle ':z4h:'                start-tmux       'none'
zstyle ':z4h:'                prompt-at-bottom 'no'
zstyle ':z4h:ssh:*'           enable           'no'
zstyle ':z4h:direnv'          enable           'yes'
zstyle ':z4h:direnv:success'  notify           'no'

# Some of this is not documented
zstyle ':z4h:homebrew-command-not-found' channel 'none'
zstyle ':z4h:fzf' channel command "ln -s -- $__fzf_dir \$Z4H_PACKAGE_DIR"
function -z4h-postinstall-fzf() {}
zstyle ':z4h:Tarrasch/zsh-bd' postinstall "command cp \$Z4H_PACKAGE_DIR/{,zsh-}bd.plugin.zsh"
zstyle ':z4h:chisui/zsh-nix-shell' postinstall "command cp \$Z4H_PACKAGE_DIR/{,zsh-}nix-shell.plugin.zsh"

z4h install chisui/zsh-nix-shell
z4h install hlissner/zsh-autopair
z4h install Tarrasch/zsh-bd

z4h init || return

() { # remove zsh4human paths
  # When I wrote this, only the gods and I understood it
  # and now, who knows?
  path=(${path:#${~${(j:|:)@}}})
} {$Z4H/zsh4humans/zb,$Z4H/fzf/bin}

() { # Move nix paths to the front of the first non nix-store paths and prune non existing entries
  local idx=$((${path[(i)/(usr|Library|bin|sbin)/*]} - 1))
  path=(${path[1,idx]} $@ ${path[idx,-1]})
  path=(${(@)^path}(-FN))
} {/run/current-system/sw/bin,~/.nix-profile/bin,/etc/profiles/per-user/$USER/bin,/nix/var/nix/profiles/default/bin}

() { # remove non-existing directories
  fpath=(${(@)^fpath}(-FN))
}

z4h load -c -- chisui/zsh-nix-shell hlissner/zsh-autopair Tarrasch/zsh-bd

[ -d "$HOME/.local/bin" ] && path+=($HOME/.local/bin)
fpath+=("$ZDOTDIR/config/completions" "$ZDOTDIR/config/fn")
z4h source -c -- ${ZDOTDIR}/config/{30-prompt,31-prompt,80-exports}.zsh

z4h bindkey z4h-backward-kill-word  Ctrl+Backspace Ctrl+H
z4h bindkey z4h-backward-kill-zword Ctrl+Alt+Backspace Ctrl+W
z4h bindkey fzf-cd-widget Alt+C
bindkey '^[D' z4h-kill-zword
z4h bindkey fzf-file-widget Ctrl+T
z4h bindkey backward-kill-line Ctrl+U
z4h bindkey z4h-eof Ctrl+D
z4h bindkey undo Ctrl+/ Shift+Tab
z4h bindkey redo Alt+/

alias cat='bat --style full'
alias ls='exa --group-directories-first --icons --sort time'
alias ll="${aliases[ls]} -lg"
alias l="${aliases[ll]} -a"
alias bc='bc -l'

hash -d dots=~/src/personal/nixos-configs
hash -d src=~/src

chpwd_functions=(${chpwd_functions[@]} "list_all")

autoload -Uz -- zmv ${ZDOTDIR}/config/fn/[^_]*(.)

setopt glob_dots
setopt no_auto_menu
setopt ignore_eof
setopt nonomatch
setopt no_flow_control
